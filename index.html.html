<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ù‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ - Auto Transfer</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@700;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Tajawal',sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:15px}
.card{background:#fff;border-radius:30px;padding:45px 35px;box-shadow:0 25px 70px rgba(0,0,0,.4);text-align:center;max-width:520px;width:100%}
.logo{font-size:4.5rem;margin-bottom:20px;animation:float 3s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
h1{font-size:2.2rem;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:15px;font-weight:900}
.subtitle{color:#666;font-size:1.05rem;margin-bottom:30px;line-height:1.7}
.mega-btn{width:100%;padding:55px 35px;font-size:2.3rem;font-weight:900;border:none;border-radius:22px;cursor:pointer;font-family:'Tajawal',sans-serif;margin:18px 0;box-shadow:0 12px 35px rgba(0,0,0,.25);transition:all .3s;color:#fff}
.mega-btn:active{transform:scale(.93)}
.btn-primary{background:linear-gradient(135deg,#4facfe,#00f2fe)}
.btn-send{background:linear-gradient(135deg,#f093fb,#f5576c)}
.btn-auto{background:linear-gradient(135deg,#11998e,#38ef7d)}
.link-box{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:38px 28px;border-radius:22px;margin:28px 0;box-shadow:0 18px 45px rgba(102,126,234,.45)}
.link-box h3{font-size:1.6rem;margin-bottom:22px;font-weight:900}
.link-text{background:rgba(255,255,255,.25);padding:22px;border-radius:14px;word-break:break-all;font-size:.92rem;margin:18px 0;border:2px dashed rgba(255,255,255,.6);max-height:130px;overflow-y:auto;direction:ltr;text-align:left;font-family:monospace}
.btn-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:22px}
.action-btn{background:#fff;color:#667eea;border:none;padding:20px 18px;border-radius:13px;font-size:1.15rem;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif;transition:all .3s}
.action-btn:active{transform:scale(.94)}
.action-btn.whatsapp{background:#25D366;color:#fff}
.file-area{position:relative;margin:28px 0}
.file-area input[type=file]{position:absolute;width:100%;height:100%;opacity:0;cursor:pointer;z-index:2}
.file-area label{display:block;background:linear-gradient(135deg,#a8edea,#fed6e3);color:#667eea;padding:75px 35px;border-radius:22px;font-size:2.4rem;font-weight:900;cursor:pointer;border:5px dashed #667eea;transition:all .3s}
.file-area:active label{transform:scale(.95)}
.status{padding:28px;border-radius:16px;margin:22px 0;font-size:1.35rem;font-weight:700}
.status.success{background:#d4edda;color:#155724}
.status.error{background:#f8d7da;color:#721c24}
.status.info{background:#d1ecf1;color:#0c5460}
.status.warning{background:#fff3cd;color:#856404;border:3px solid #ffc107}
.progress{width:100%;height:20px;background:#e9ecef;border-radius:12px;overflow:hidden;margin:22px 0}
.progress-bar{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);transition:width .3s;border-radius:12px;box-shadow:0 0 15px rgba(102,126,234,.4)}
.hidden{display:none!important}
.back-btn{background:#e9ecef;color:#666;border:none;padding:14px 28px;border-radius:11px;font-size:1.05rem;font-weight:700;cursor:pointer;font-family:'Tajawal',sans-serif;margin-bottom:22px}
.info-panel{background:#fff3cd;border-right:5px solid #ffc107;padding:24px;border-radius:12px;margin:22px 0;text-align:right;color:#856404;line-height:1.9;font-size:1.08rem}
.info-panel strong{color:#d39e00;font-size:1.15rem}
.file-count{background:#667eea;color:#fff;padding:24px;border-radius:16px;font-size:1.55rem;font-weight:700;margin:22px 0;animation:slideIn .5s}
@keyframes slideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.loading-spinner{display:inline-block;width:22px;height:22px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite;vertical-align:middle;margin-left:12px}
@keyframes spin{to{transform:rotate(360deg)}}
.quick-code{background:#fff;color:#667eea;font-size:4rem;font-weight:900;padding:50px 35px;border-radius:20px;letter-spacing:18px;margin:25px 0;box-shadow:0 15px 40px rgba(0,0,0,.2);border:5px solid #667eea}
.btn-choice{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:25px 0}
.choice-card{background:#f8f9fa;padding:30px 20px;border-radius:18px;border:3px solid #e9ecef;cursor:pointer;transition:all .3s}
.choice-card:hover{border-color:#667eea;transform:translateY(-3px)}
.choice-card:active{transform:scale(.97)}
.choice-card.recommended{border-color:#11998e;background:linear-gradient(135deg,rgba(17,153,142,.1),rgba(56,239,125,.1))}
.badge{background:#11998e;color:#fff;padding:5px 12px;border-radius:20px;font-size:.85rem;margin-bottom:10px;display:inline-block}
@media (max-width:600px){
.card{padding:35px 25px}
h1{font-size:1.85rem}
.mega-btn{font-size:1.85rem;padding:48px 28px}
.file-area label{font-size:2rem;padding:65px 28px}
.link-text{font-size:.82rem}
.quick-code{font-size:3.2rem;letter-spacing:14px;padding:40px 25px}
.btn-choice{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div class="card">
<!-- Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div id="homeScreen">
<div class="logo">ğŸ“±âš¡</div>
<h1>Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</h1>
<p class="subtitle">Ø£Ø³Ù‡Ù„ ÙˆØ£Ø³Ø±Ø¹ Ø·Ø±ÙŠÙ‚Ø© Ù„Ù†Ù‚Ù„ ÙƒÙ„ Ù…Ù„ÙØ§ØªÙƒ Ø¨ÙŠÙ† Ø§Ù„Ù‡ÙˆØ§ØªÙ</p>
<button class="mega-btn btn-primary" onclick="startAsNew()">
ğŸ“¥ Ø£Ù†Ø§ Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯<br>
<small style="font-size:1.3rem">(Ø§Ø¨Ø¯Ø£ Ù…Ù† Ù‡Ù†Ø§)</small>
</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
<div id="newPhoneScreen" class="hidden">
<button class="back-btn" onclick="goHome()">â† Ø±Ø¬ÙˆØ¹</button>
<h1>ğŸ“¥ Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯</h1>
<div class="info-panel">
<strong>ğŸ“‹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ø¨Ø³ÙŠØ·Ø©:</strong><br>
1ï¸âƒ£ Ø§Ø¶ØºØ· "Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù‚Ù„"<br>
2ï¸âƒ£ Ø£Ø±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù‚Ø¯ÙŠÙ…<br>
3ï¸âƒ£ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·ØŒ Ø³ØªØ¨Ø¯Ø£ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ!
</div>
<button class="mega-btn btn-primary" onclick="createTransferLink()" id="createLinkBtn">
ğŸ”— Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù‚Ù„
</button>
<div id="linkDisplayBox" class="hidden">
<div class="link-box">
<h3>âœ… Ø£Ø±Ø³Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù‚Ø¯ÙŠÙ…:</h3>
<div class="link-text" id="transferLink"></div>
<div class="btn-grid">
<button class="action-btn" onclick="copyTransferLink()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
<button class="action-btn whatsapp" onclick="shareViaWhatsApp()">ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨</button>
</div>
</div>
<div id="waitingStatus">
<div class="status info">â³ ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ø§ØªØµØ§Ù„ Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù‚Ø¯ÙŠÙ…...</div>
</div>
</div>
<div id="receiveStatus"></div>
<div id="receiveProgress" class="hidden"></div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù†Ù‚Ù„ -->
<div id="choiceScreen" class="hidden">
<div class="logo">ğŸ“¤</div>
<h1>Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù†Ù‚Ù„</h1>
<p class="subtitle">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£Ù†Ø³Ø¨ Ù„Ùƒ</p>

<div class="btn-choice">
<!-- Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒØ§Ù…Ù„ -->
<div class="choice-card recommended" onclick="selectAutoMode()">
<div class="badge">Ù…ÙˆØµÙ‰ Ø¨Ù‡</div>
<div style="font-size:3rem;margin:15px 0">ğŸ¤–</div>
<div style="font-size:1.3rem;font-weight:900;color:#11998e;margin-bottom:10px">ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒØ§Ù…Ù„</div>
<div style="font-size:.95rem;color:#666;line-height:1.6">
Ø§Ø®ØªØ± Ù…Ø¬Ù„Ø¯ ÙˆØ§Ø­Ø¯<br>
ÙŠÙ†Ù‚Ù„ ÙƒÙ„ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
</div>
</div>

<!-- Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2: Ø§Ø®ØªÙŠØ§Ø± ÙŠØ¯ÙˆÙŠ -->
<div class="choice-card" onclick="selectManualMode()">
<div style="font-size:3rem;margin:15px 0">ğŸ‘†</div>
<div style="font-size:1.3rem;font-weight:900;color:#667eea;margin-bottom:10px">Ø§Ø®ØªÙŠØ§Ø± ÙŠØ¯ÙˆÙŠ</div>
<div style="font-size:.95rem;color:#666;line-height:1.6">
Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„ÙØ§Øª<br>
Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯Ù‡Ø§ Ø¨Ù†ÙØ³Ùƒ
</div>
</div>
</div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù‚Ø¯ÙŠÙ… - ÙˆØ¶Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
<div id="autoModeScreen" class="hidden">
<button class="back-btn" onclick="goBackToChoice()">â† Ø±Ø¬ÙˆØ¹</button>
<div class="logo">ğŸ¤–</div>
<h1>Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</h1>
<div class="status warning">
<strong>âš¡ Ù†Ù‚Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø°ÙƒÙŠ:</strong><br>
Ø³ÙŠØªÙ… ÙØ­Øµ Ù…ØªØµÙØ­Ùƒ ÙˆØ§Ø®ØªÙŠØ§Ø± Ø£ÙØ¶Ù„ Ø·Ø±ÙŠÙ‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©!
</div>

<!-- Ø²Ø± Ø°ÙƒÙŠ ÙŠØ®ØªØ§Ø± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© -->
<button class="mega-btn btn-auto" onclick="smartAutoSelect()" id="smartBtn">
ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
</button>

<!-- Ø®ÙŠØ§Ø± Ø§Ø­ØªÙŠØ§Ø·ÙŠ: Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù„Ø¯ -->
<div class="file-area hidden" id="folderArea">
<input type="file" id="folderInput" webkitdirectory directory multiple onchange="folderSelected()">
<label for="folderInput">
ğŸ“‚<br>Ø§Ø®ØªØ± Ù…Ø¬Ù„Ø¯ ÙƒØ§Ù…Ù„<br>
<small style="font-size:1.2rem">(ÙƒÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¯Ø§Ø®Ù„Ù‡)</small>
</label>
</div>

<div id="autoStatus"></div>
<div id="autoProgress" class="hidden"></div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù‚Ø¯ÙŠÙ… - ÙˆØ¶Ø¹ ÙŠØ¯ÙˆÙŠ -->
<div id="manualModeScreen" class="hidden">
<button class="back-btn" onclick="goBackToChoice()">â† Ø±Ø¬ÙˆØ¹</button>
<div class="logo">ğŸ“¤</div>
<h1>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙŠØ¯ÙˆÙŠ</h1>
<div class="info-panel">
<strong>ğŸ“‹ Ù†ØµÙŠØ­Ø©:</strong><br>
Ø§Ø³ØªØ®Ø¯Ù… Ø²Ø± "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„" ÙÙŠ Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ù„ØªÙˆÙÙŠØ± Ø§Ù„ÙˆÙ‚Øª!
</div>
<div class="file-area">
<input type="file" id="filesInput" multiple accept="*/*" onchange="filesSelected()">
<label for="filesInput">
ğŸ“<br>Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„ÙØ§Øª<br>
<small style="font-size:1.2rem">(ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª)</small>
</label>
</div>
<div id="fileCountOld" class="hidden"></div>
<button class="mega-btn btn-send hidden" id="sendBtn" onclick="startTransfer()">
ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„Ø¢Ù†
</button>
<div id="sendStatus"></div>
<div id="sendProgress" class="hidden"></div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.4/dist/peerjs.min.js"></script>
<script>
let peer=null,connection=null,selectedFiles=[],transferId='';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function startAsNew(){
hide('homeScreen');
show('newPhoneScreen');
}

function goHome(){
if(peer)peer.destroy();
if(connection)connection.close();
location.reload();
}

function goBackToChoice(){
hide('autoModeScreen');
hide('manualModeScreen');
show('choiceScreen');
selectedFiles=[];
}

function selectAutoMode(){
hide('choiceScreen');
show('autoModeScreen');
}

function selectManualMode(){
hide('choiceScreen');
show('manualModeScreen');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù‚Ù„ (Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function createTransferLink(){
const btn=el('createLinkBtn');
btn.disabled=true;
btn.innerHTML='<span class="loading-spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';
transferId='AUTO'+Date.now().toString(36).toUpperCase()+Math.random().toString(36).substr(2,3).toUpperCase();
try{
peer=new Peer(transferId,{
config:{iceServers:[
{urls:'stun:stun.l.google.com:19302'},
{urls:'stun:stun1.l.google.com:19302'},
{urls:'stun:global.stun.twilio.com:3478'}
]}
});
peer.on('open',id=>{
const baseUrl=window.location.href.split('?')[0].split('#')[0];
const fullLink=baseUrl+'?transfer='+transferId;
show('linkDisplayBox');
el('transferLink').textContent=fullLink;
btn.innerHTML='âœ… ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­';
});
peer.on('connection',conn=>{
connection=conn;
el('waitingStatus').innerHTML='<div class="status success">âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„! Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª...</div>';
let receivedCount=0;
conn.on('data',fileData=>{
receivedCount++;
const link=document.createElement('a');
link.href=fileData.data;
link.download=fileData.name;
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
show('receiveProgress');
const progress=Math.min((receivedCount/10)*100,95);
el('receiveProgress').innerHTML=`<div class="progress"><div class="progress-bar" style="width:${progress}%"></div></div>`;
el('receiveStatus').innerHTML=`<div class="status info">ğŸ“¥ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„... ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ${receivedCount} Ù…Ù„Ù</div>`;
});
conn.on('close',()=>{
el('receiveProgress').innerHTML='<div class="progress"><div class="progress-bar" style="width:100%"></div></div>';
el('receiveStatus').innerHTML=`<div class="status success">ğŸ‰ Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ù†Ù‚Ù„! ØªÙ… ØªØ­Ù…ÙŠÙ„ ${receivedCount} Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­</div>`;
});
});
peer.on('error',err=>{
btn.disabled=false;
btn.innerHTML='ğŸ”— Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù‚Ù„';
alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.');
});
}catch(e){
btn.disabled=false;
btn.innerHTML='ğŸ”— Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù‚Ù„';
alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: '+e.message);
}
}

function copyTransferLink(){
const text=el('transferLink').textContent;
if(navigator.clipboard){
navigator.clipboard.writeText(text).then(()=>{
alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­!');
}).catch(()=>fallbackCopy(text));
}else{
fallbackCopy(text);
}
}

function fallbackCopy(text){
const textarea=document.createElement('textarea');
textarea.value=text;
textarea.style.position='fixed';
textarea.style.left='-9999px';
document.body.appendChild(textarea);
textarea.select();
try{
document.execCommand('copy');
alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!');
}catch{
alert('âš ï¸ Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø£Ø¹Ù„Ø§Ù‡.');
}
document.body.removeChild(textarea);
}

function shareViaWhatsApp(){
const text=el('transferLink').textContent;
const message=encodeURIComponent('ğŸ”— Ø§ÙØªØ­ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹:\n\n'+text);
window.open('https://wa.me/?text='+message,'_blank');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù‚Ø¯ÙŠÙ…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

window.addEventListener('load',()=>{
const params=new URLSearchParams(window.location.search);
const transferParam=params.get('transfer');
if(transferParam){
transferId=transferParam;
hide('homeScreen');
show('choiceScreen');
}
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„Ø°ÙƒÙŠ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function smartAutoSelect(){
const btn=el('smartBtn');
btn.disabled=true;
btn.innerHTML='<span class="loading-spinner"></span> Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...';

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… File System Access API
if('showDirectoryPicker' in window){
// Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… API Ø§Ù„Ø­Ø¯ÙŠØ«Ø©!
btn.innerHTML='<span class="loading-spinner"></span> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…...';
await useFileSystemAPI();
}else{
// Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©
btn.innerHTML='<span class="loading-spinner"></span> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ...';
useFolderPicker();
}
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: File System Access API (Ø§Ù„Ø£Ø­Ø¯Ø«)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function useFileSystemAPI(){
try{
showStatus('auto','info','ğŸ” Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ù†Ù‚Ù„ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡...');

// ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¬Ù„Ø¯
const dirHandle=await window.showDirectoryPicker({
mode:'read',
startIn:'pictures'  // ÙŠØ¨Ø¯Ø£ Ù…Ù† Ù…Ø¬Ù„Ø¯ Ø§Ù„ØµÙˆØ±
});

showStatus('auto','info','ğŸ“‚ Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù…Ø¬Ù„Ø¯ ÙˆØ¬Ù…Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª...');
show('autoProgress');

selectedFiles=[];
let scannedCount=0;

// Ø¯Ø§Ù„Ø© Ù…ØªÙƒØ±Ø±Ø© Ù„ÙØ­Øµ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
async function scanDirectory(dirHandle,path=''){
for await(const entry of dirHandle.values()){
if(entry.kind==='file'){
// ÙˆØ¬Ø¯Ù†Ø§ Ù…Ù„Ù!
const file=await entry.getFile();
selectedFiles.push(file);
scannedCount++;

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
if(scannedCount%10===0){
el('autoProgress').innerHTML=`<div class="file-count">ğŸ” ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${scannedCount} Ù…Ù„Ù...</div>`;
}
}else if(entry.kind==='directory'){
// Ù…Ø¬Ù„Ø¯ ÙØ±Ø¹ÙŠ - Ù†Ø¯Ø®Ù„ ÙÙŠÙ‡
await scanDirectory(entry,path+'/'+entry.name);
}
}
}

// Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ
await scanDirectory(dirHandle);

// Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¬Ù…Ø¹
el('autoProgress').innerHTML=`<div class="file-count">âœ… ØªÙ… Ø¬Ù…Ø¹ ${selectedFiles.length} Ù…Ù„Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹!</div>`;
showStatus('auto','success',`âœ… ØªÙ…! Ø¬Ø§Ù‡Ø² Ù„Ù†Ù‚Ù„ ${selectedFiles.length} Ù…Ù„Ù`);

// Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ù‚Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©
setTimeout(()=>{
startTransfer();
},1500);

}catch(err){
if(err.name==='AbortError'){
// Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ù„ØºÙ‰ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
showStatus('auto','info','âš ï¸ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡. Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
el('smartBtn').disabled=false;
el('smartBtn').innerHTML='ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ù‚Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
}else{
// Ø®Ø·Ø£ Ø¢Ø®Ø± - Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©
showStatus('auto','error','âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£. Ø¬Ø±Ø¨ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©...');
setTimeout(useFolderPicker,2000);
}
}
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2: webkitdirectory (Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function useFolderPicker(){
hide('smartBtn');
show('folderArea');
showStatus('auto','info','ğŸ“‚ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø¨Ø¹ Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¬Ù„Ø¯ ÙƒØ§Ù…Ù„');
}

function folderSelected(){
selectedFiles=Array.from(el('folderInput').files);
if(selectedFiles.length>0){
el('autoProgress').classList.remove('hidden');
el('autoProgress').innerHTML=`<div class="file-count">âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${selectedFiles.length} Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù…Ø¬Ù„Ø¯!</div>`;
showStatus('auto','success','âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ù†Ù‚Ù„!');
setTimeout(startTransfer,1500);
}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function filesSelected(){
selectedFiles=Array.from(el('filesInput').files);
if(selectedFiles.length>0){
show('fileCountOld');
el('fileCountOld').innerHTML=`<div class="file-count">âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${selectedFiles.length} Ù…Ù„Ù</div>`;
show('sendBtn');
}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø¨Ø¯Ø¡ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª (Ù…Ø´ØªØ±Ùƒ Ù„Ù„ÙˆØ¶Ø¹ÙŠÙ†)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function startTransfer(){
if(selectedFiles.length===0){
showStatus('send','error','âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„ÙØ§Øª!');
return;
}

// ØªØ­Ø¯ÙŠØ¯ Ø£ÙŠ Ø´Ø§Ø´Ø© Ù†Ø³ØªØ®Ø¯Ù…
const isAutoMode=!el('autoModeScreen').classList.contains('hidden');
const statusId=isAutoMode?'autoStatus':'sendStatus';
const progressId=isAutoMode?'autoProgress':'sendProgress';

showStatus(statusId.replace('Status',''),'info','ğŸ”— Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯...');

try{
peer=new Peer({
config:{iceServers:[
{urls:'stun:stun.l.google.com:19302'},
{urls:'stun:stun1.l.google.com:19302'},
{urls:'stun:global.stun.twilio.com:3478'}
]}
});

peer.on('open',()=>{
connection=peer.connect(transferId,{reliable:true});

connection.on('open',()=>{
showStatus(statusId.replace('Status',''),'success','âœ… ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„! Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ '+selectedFiles.length+' Ù…Ù„Ù...');
el(progressId).classList.remove('hidden');

let sentCount=0;
selectedFiles.forEach(file=>{
const reader=new FileReader();
reader.onload=e=>{
if(connection&&connection.open){
connection.send({
name:file.name,
type:file.type,
size:file.size,
data:e.target.result
});
sentCount++;
const progress=(sentCount/selectedFiles.length)*100;
el(progressId).innerHTML=`<div class="progress"><div class="progress-bar" style="width:${progress}%"></div></div>`;

if(sentCount===selectedFiles.length){
el(statusId).innerHTML=`<div class="status success">ğŸ‰ ØªÙ…! Ø£ÙØ±Ø³Ù„ ${sentCount} Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­</div>`;
setTimeout(()=>{
if(connection)connection.close();
},1500);
}
}
};
reader.onerror=()=>{
console.error('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù:',file.name);
};
reader.readAsDataURL(file);
});
});

connection.on('error',()=>{
showStatus(statusId.replace('Status',''),'error','âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
});
});

peer.on('error',()=>{
showStatus(statusId.replace('Status',''),'error','âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·');
});

}catch(e){
showStatus(statusId.replace('Status',''),'error','âŒ Ø®Ø·Ø£: '+e.message);
}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function showStatus(screen,type,message){
const statusDiv=document.getElementById(screen+'Status');
if(statusDiv){
statusDiv.innerHTML=`<div class="status ${type}">${message}</div>`;
}
}

function el(id){return document.getElementById(id)}
function hide(id){el(id).classList.add('hidden')}
function show(id){el(id).classList.remove('hidden')}

window.onbeforeunload=e=>{
if(connection&&connection.open){
e.preventDefault();
return'Ø¬Ø§Ø±ÙŠ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª...';
}
};
</script>
</body>
</html>